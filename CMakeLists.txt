CMAKE_MINIMUM_REQUIRED(VERSION 3.15)

PROJECT(resizable_buffer LANGUAGES CXX)

SET(CMAKE_CXX_STANDARD 20)
SET(CMAKE_EXPORT_COMPILE_COMMANDS on)
SET(CMAKE_CXX_FLAGS "-O0 -Wall -g -ggdb")

SET(BUILD_TESTS TRUE CACHE BOOL "if to build tests")

SET(DEFAULT_BUFFER_SIZE 1024 CACHE STRING "default buffer size")

if (NOT CMAKE_BUILD_TYPE)
    SET(CMAKE_BUILD_TYPE Debug)
endif()

if (NOT BUILD_SHARED)
    SET(BUILD_SHARED_LIBS TRUE)
endif()

ADD_LIBRARY(${PROJECT_NAME})
TARGET_COMPILE_DEFINITIONS(${PROJECT_NAME} PUBLIC DEFAULT_BUFFER_SIZE=${DEFAULT_BUFFER_SIZE})
TARGET_INCLUDE_DIRECTORIES(${PROJECT_NAME} PUBLIC src)
TARGET_SOURCES(${PROJECT_NAME} PRIVATE src/buffer.cpp)

if (BUILD_TESTS)
    FIND_PACKAGE(fmt)

    INCLUDE(FetchContent)
    FetchContent_Declare(
        ut
        GIT_REPOSITORY "https://github.com/boost-ext/ut.git"
        GIT_TAG master
    )
    FetchContent_MakeAvailable(ut)

    ENABLE_TESTING()
    ADD_SUBDIRECTORY(tests)
endif()
